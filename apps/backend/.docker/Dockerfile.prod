FROM node:22-alpine AS build
WORKDIR /feedstand

ARG VERSION_TAG
ENV VERSION_TAG=${VERSION_TAG}

COPY package*.json .
COPY tsconfig.json .
COPY apps/backend/package.json apps/backend/
RUN npm ci -w apps/backend --ignore-scripts

COPY apps/backend apps/backend/
RUN npm run build -w apps/backend

FROM node:22-alpine
WORKDIR /feedstand

COPY --from=build /feedstand/apps/backend/dist .

EXPOSE 4001
CMD ["node", "index.js"]
